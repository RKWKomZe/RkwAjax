!function(n,i){var s="ajaxApi",a={boxSuccessClass:"success",boxHintClass:"hint",boxErrorClass:"error",loadingBoxClass:"loading-box",loadingLinkClass:"is-ajax-loading"};function e(t,e){this.element=t,this.settings=n.extend({},a,e),this._defaults=a,this._name=s,this.init()}n.extend(e.prototype,{init:function(){this.settings.$el=n(this.element),this.settings.elementType=this.settings.$el.prop("tagName"),"FORM"===this.settings.elementType?(this.settings.formElements=this.settings.$el.find(":input:not(.btn)"),this.settings.url=this.settings.$el.attr("action"),this.settings.$el.hasClass("ajax-feedback")&&(this.settings.feedbackUrl=this.settings.$el.attr("data-feedback-url"))):"A"===this.settings.elementType&&(this.settings.url=this.settings.$el.attr("href")),this.bindEvents()},bindEvents:function(){var t;"FORM"===this.settings.elementType?(t=this).settings.$el.hasClass("ajax")&&this.settings.$el.hasClass("ajax-feedback")?(this.settings.formElements.each(function(){n(this).on("change",t.sendField.bind(t))}),this.settings.$el.on("submit",this.sendForm.bind(this))):this.settings.$el.hasClass("ajax")&&(this.settings.$el.on("submit",this.sendForm.bind(this)),this.settings.formElements.each(function(){n(this).on("change",t.sendForm.bind(t))}),this.settings.$el.find(".ajax-send")&&this.settings.$el.find(".ajax-send").each(function(){n(this).on("click",t.sendFormByLink.bind(t))}),this.settings.$el.find(".ajax-override-submit")&&this.settings.$el.find(".ajax-override-submit").each(function(){n(this).on("click",t.sendNormalFormByLink.bind(t))}),this.settings.$el.find(".ajax-override")&&this.settings.$el.find(".ajax-override").each(function(){"A"===n(this).prop("tagName")?n(this).on("click",t.overrideForm.bind(t)):"SELECT"===n(this).prop("tagName")&&n(this).on("change",t.overrideForm.bind(t))})):"A"===this.settings.elementType&&this.settings.$el.on("click",this.sendLink.bind(this))},sendForm:function(t){var e,s;t.preventDefault(),this.settings.$el.hasClass("override-submit")||(e=this.settings.url,s=this.getFormValues(),this.ajaxRequest(e,s))},sendFormByLink:function(t){t.preventDefault(),this.sendForm(t)},sendNormalFormByLink:function(t){t.preventDefault();var e=n(t.currentTarget),s=e.closest("form.ajax");s.attr("action",e.attr("href")).addClass("override-submit"),s.unbind("submit"),s.submit()},sendLink:function(t){t.preventDefault();var e=this.settings.url;this.settings.$el.hasClass(this.settings.loadingLinkClass)||(this.settings.$el.addClass(this.settings.loadingLinkClass).blur(),this.ajaxRequest(e,[]))},sendField:function(t){var e=n(t.currentTarget),s=this.settings.feedbackUrl,i=e.serializeArray();this.ajaxRequest(s,i)},overrideForm:function(t){t.preventDefault();var e,s=n(t.currentTarget),i=this.settings.$el.find("select, input").not(".ajax-override").serializeArray();"A"===s.prop("tagName")?e=s.attr("href"):"SELECT"===s.prop("tagName")&&(e=s.val()),this.ajaxRequest(e,i)},getFormValues:function(){return this.settings.$el.serializeArray()},ajaxRequest:function(t,e){var s=this;e.unshift({name:"type",value:250}),n.ajax({method:"get",url:t,data:n.param(e),dataType:"json",complete:function(t){try{t=JSON.parse(t.responseText),s.parseContent(t)}catch(t){console.log(t.message)}}})},parseContent:function(t){for(var e in t)if("message"===e){var s=t[e];for(var i in s){var n=this.getMessageBox(s[i].message,s[i].type,i);this.appendContent(i,n)}}else if("data"!==e&&"html"===e){var a=t[e];for(var i in a)for(var r in a[i])"append"===r?this.appendContent(i,a[i][r]):"prepend"===r?this.prependContent(i,a[i][r]):"replace"===r&&this.replaceContent(i,a[i][r])}},appendContent:function(t,e){try{var s=jQuery(e).appendTo(jQuery("#"+t)).ajaxApi();jQuery("#"+t).find("."+this.settings.loadingBoxClass).remove(),jQuery(i).trigger("rkw-ajax-api-content-changed",s.parent())}catch(t){}},prependContent:function(t,e){try{var s=jQuery(e).prependTo(jQuery("#"+t)).ajaxApi();jQuery("#"+t).find("."+this.settings.loadingBoxClass).remove(),jQuery(i).trigger("rkw-ajax-api-content-changed",s.parent())}catch(t){}},replaceContent:function(t,e){try{var s;0<jQuery(e).length?(s=jQuery(e).appendTo(jQuery("#"+t).empty()).ajaxApi(),jQuery(i).trigger("rkw-ajax-api-content-changed",s)):jQuery("#"+t).empty().append(e).ajaxApi()}catch(t){}},getMessageBox:function(t,e,s){var i=jQuery('<div class="message-box" data-for="#'+s+'">'+t+"</div>");return 1===e?i.addClass(this.settings.boxSuccessClass):2===e?i.addClass(this.settings.boxHintClass):99===e&&i.addClass(this.settings.boxErrorClass),i}}),n.fn[s]=function(t){return this.each(function(){n.data(this,"plugin_"+s)||n.data(this,"plugin_"+s,new e(this,t))})}}(jQuery,(window,document));